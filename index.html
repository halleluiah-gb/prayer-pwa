<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#0d6efd" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="manifest" href="/prayer-pwa/manifest.json" />
  <link rel="apple-touch-icon" href="/prayer-pwa/icon-192.png" />
  <link rel="icon" href="/prayer-pwa/icon-192.png" />
  <link rel="stylesheet" href="/prayer-pwa/style.css" />
  <title>Prayer Tracker</title>
</head>
<body>
  <main>
    <h1>ğŸ™ Prayer Tracker</h1>
    <form id="prayerForm">
      <input type="text" id="nameInput" placeholder="Enter your name" required />
      <button type="submit">Send to Apps Script</button>
    </form>
    <p id="responseArea">Waiting...</p>
    <button id="installBtn" onclick="installApp()" style="display: none;">ğŸ“² Add to Home Screen</button>
  </main>

  <script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwp0od-C3Pun0Mj7b1a_DnX6DpQTg7fNKG1vx8eZwou7r2h2maV23lzOGLV5d5iuIgE/exec';

    document.getElementById('prayerForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = document.getElementById('nameInput').value;
      const responseArea = document.getElementById('responseArea');
      responseArea.textContent = 'Sending...';
      try {
        const res = await fetch(`${SCRIPT_URL}?name=${encodeURIComponent(name)}`);
        const data = await res.json();
        responseArea.textContent = data.message;
      } catch (err) {
        responseArea.textContent = 'Failed to connect.';
      }
    });

    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      document.getElementById('installBtn').style.display = 'block';
    });

    function installApp() {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then(() => {
          deferredPrompt = null;
          document.getElementById('installBtn').style.display = 'none';
        });
      }
    }

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/prayer-pwa/sw.js')
        .then(() => console.log('Service Worker registered'));
    }
  </script>
</body>
</html>
